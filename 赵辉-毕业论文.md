# 一、引言

​		煤矿水仓位于矿井下同一水平各处水的流经通道的末端，担负着沉淀水中煤粉及杂质的作用。正常作业状态下煤粉及杂质不断在水仓沉积，被淤满后必须及时清空待用，否则可能会影响矿井的正常排水，甚至导致淹井等重大事故。水仓是由水仓通道和主、副水仓组成的，是矿井涌水的储存巷道，还起着澄清污水的沉淀作用。水仓容积率是指水仓有效储水体积与水仓净体积(不含水仓通道及清理斜巷)的比值，是衡量水仓设计工作优劣的一个重要指标。提高水仓设计容积率是减小水仓长度、节省水仓投资的一个重要途径。随着水仓使用时间的推移，水中的淤泥逐渐积累，从而使得水仓的实际储水容积变小，为矿井的正常生产埋下隐患。《煤矿安全规程》第280条规定：“水仓的空仓容量应当经常保持在总容量的50％以上”。然而因为水仓内的水是浑浊的，人眼看的不是很清楚，所以不能确定淤泥积累的程度。因此，我们需要一个可以确定淤泥厚度、并且在适时的时候向工作人员提供警报的设置。这对于整个煤矿的安全运作有着至关重要的作用。

# 二、国内外现状

## 2.1 淤泥检测技术概述

1、人工插杆目测

它主要是通过工作人员定时地用竹竿插入沉淀池内，拔出后根据粘附在竹竿上污泥痕迹的位置推断出池中污泥的粗略位置。这是一种非常落后的方法，需要操作人员到二沉池或浓缩池上现场工作。不仅劳动强度大而且在光线暗淡或泥色较浅时难以准确判断。这使得出的结果与实际污泥的泥位往往有较大出入，测量结果难以满足实际要求。

2、脉动红外测试

随着大规模集成电路记微型计算机的发展和推广应用，自七十年代以来，发达国家的一些环保厂商把微机和光学技术相结合研制专用光电传感器，将其应用于二沉池和浓缩池的固液界面。其原理是基于透光脉动悬浮颗粒检测技术理论。

悬浊液的浊度通常是通过其透光强度来确定的。因此其浊度大小取决于单位体积悬浊液内杂质的颗粒数目和颗粒的光散射特性。对单一径粒组成的悬浊液，假设单位体积悬浊液中有 N 个颗粒，颗粒的光散射界面为 C，则当一束光通过长度为 L 的悬浊液的透光强度为 I，则： 
$$
I=I0exp(-NCL)
$$


式中

I~2~O为入射光强度。

式（1）称为 Lambert－Beer 定律。

通过光电管接收转换透射光信号为电信号后，经过微机进行处理计算即可知道被测悬浊液的当前浊度。如果通过控制电机带动光电传感器在沉淀池中上下运动采样，则可全面地检测沉淀池中污泥浊度的分布状况。这种方法精度较高。值得注意的是在污泥浓度相对较高，污泥颗粒较大的环境中，透射光的强度将大为减弱，这将增加检测透射光光强度的难度。同时，在浓度较高的场合，光探头也容易粘附悬浮颗粒，影响测量的精度。因此此法比较适合于检测浊度不甚高的悬浊液。另外由于需要自动升降设备，系统在设计上也相对复杂些，特别是存在电机和减速器等可动机电装置，需要经常维护。因此在浊度很大的的水仓中，通常不采用这类设备。

3、电容法

根据当平板的正对面积和板间距离两者的值一定时，电容量与介电常数成正比，所以，不同介质下，介电常数大不相同，那么电容量也就存在明显差异，从而通过所测量的电容量的大小差异就可实现对介质的区分。

4、电导率法

根据过不同介质电导率不同的性质对介质进行区分，即根据空气、水、淤泥的电导率值之间的差异，对空气和水、水和淤泥进行区分，从而测得水位和泥位。

5、电磁波法

电磁波具有传播速度快、不受反射物形状影响等特性,微波脉冲从雷达天线发射出来,以光速在空间传播,通过淤泥面反射回来并被雷达接收。电磁波信号在空间中的传播速度为光速,通常在测量距离时,发射脉冲与接收脉冲的时间差极短,只有纳秒量级,设备采用先进的等效采样方法将原本纳秒级的时间间隔准确地测量出来, 从而实现对距离的准确测量。

## 2.2 超声波监测技术介绍

超声波具有以下几个特点：

1、超声波在传播时，波长短，方向性强，能量易于集中，频率高，衍射不严重，具有良好的定向性

2、超声波能在各种不同媒质中传播，且可传播足够远的距离。

3、超声波可在气体、液体、固体、固熔体等介质中有效传播。

​		超声波测距仪对淤泥厚度进行测量的原理与测量水位的原理相同，都是采用回声测距的原理，即声波以一定的速度在均匀介质中传播，传播过程中若遇到不同介质的界面，则立即反射回波，因此，当超声波以空气为传播介质时，声波经过空气传播遇到水平面时则反射回波，即可实现对水位的测量，而以水为传播介质时，声波经过水传播至淤泥层表面，也会立即反射回波，从而实现对淤泥厚度的测量。虽然超声波、光波、雷达进行测距的原理都是类似的，但因声波的速度远远低于光速，所以相比较之下超声波的反射回波更容易被测量到。

## 2.3 淤泥界面监测技术国内外现状

​		界面检测是物位(包括料位、液位、界面)检测的一个方面，是层状介质界面检测技术的应用之一。目前，界面检测的方法有：直读法、静压法、浮力法、电容式等接触测量方法，也有同位素、超声波、雷达等非接触测量方法。现在比较常用的界面检测的方法主要有两种：电容式界面检测和超声波界面检测。

​		基于电容传感器界面检测理论的应用早在上世纪九十年代就已经开始。原江汉石油学院的武洪涛设计了电容式油水界面检测仪[9]，将涂有绝缘层的金属电极垂直放在油、水之中，利用电容与电极在水中长度之间的线性正比关系，测出电容即可求出电极在水中部分的长度，从而确定油水界面的位置。这是比较早的应用。

​		在淤泥界面检测方面，国外的研究相对较多，并已有成型产品，如西门子公司的DSP300污泥界面计，德菲公司的CSM-5000超声波泥水界面仪，哈希公司的OptiQuant污泥界面监测仪等。国内在淤泥界面检测方面也做了一些研究。机械科学研究院环保所王朝阳等人设计了自动跟踪式污泥界面计，利用超声波测量污泥浓度来自动跟踪污泥界面；东南大学的张峰设计了基于80C196单片机的淤泥界面测量系统，用于污水处理厂沉淀池的泥水界面检测。虽然国内在沉淀池淤泥界面检测方面取得了一些成果，但尚未有定型产品出现，其性能与国外同类产品还存在一定差距，目前国内的污水处理企业中此类设备大多还是只能依赖进口。

# 三、总体设计

​		该系统由硬件部分、通信部分、软件部分和数据库部分组成。硬件部分包含超声波传感器、单片机处理器、温度补偿模块、去噪模块四个部分。

## 3.1 超声波传感器

​		超声波是一种在弹性介质中的机械振荡，有两种形式：横向振荡（横波）及纵向振荡（纵波）。在工业中应用主要采用纵向振荡。超声波可以在气体、液体及固体中传播，其传播速度不同。另外，它也有折射和反射现象，并且在传播过程中有衰减。在空气中传播超声波，其频率较低，一般为几十KHZ，而在固体、液体中则频率可用得较高。在空气中衰减较快，而在液体及固体中传播，衰减较小，传播较远。利用超声波的特性，可做成各种超声传感器，配上不同的电路，制成各种超声测量仪器及装置，并在通讯，医疗家电等各方面得到广泛应用。

​		超声波传感器主要材料有压电晶体（电致伸缩）及镍铁铝合金（磁致伸缩）两类。电致伸缩的材料有锆钛酸铅（PZT）等。压电晶体组成的超声波传感器是一种可逆传感器，它可以将电能转变成机械振荡而产生超声波，同时它接收到超声波时，也能转变成电能，所以它可以分成发送器或接收器。

​		超声波传感器主要由如下四个部分构成：

- 发送器：通过振子（一般为陶瓷制品，直径约为15 mm）振动产生超声波并向空中幅射。
- 接收器：振子接收到超声波时，根据超声波发生相应的机械振动，并将其转换为电能量，作为接收器的输出。
- 控制部分：通过用集成电路控制发送器的超声波发送，并判断接收器是否接收到信号（超声波），以及已接收信号的大小。
- 电源部分：超声波传感器通常采用电压为DC12V ± 10 % 或 24V ± 10 %外部直流电源供电，经内部稳压电路供给传感器工作。

### 3.1.1 超声波测距原理

​		超声波发射器向某一方向发射超声波，在发射时刻的同时开始计时，超声波在空气中传播，途中碰到障碍物就立即返回来，超声波接收器收到反射波就立即停止计时。超声波在空气中的传播速度为340m/s，根据计时器记录的时间t，就可以计算出发射点距障碍物的距离(s)，即：s=340t/2 。这就是所谓的时间差测距法。

​		超声波测距的原理是利用超声波在空气中的传播速度为已知，测量声波在发射后遇到障碍物反射回来的时间，根据发射和接收的时间差计算出发射点到障碍物的实际距离。由此可见，超声波测距原理与雷达原理是一样的。

测距的公式表示为：S=0.5×VT

式中S为测量的距离长度；V为超声波在空气中的传播速度；T为测量距离传播的时间差

###  3.1.2 超声波传感器的选择

​		超声波换能器在测量系统中占据着重要地位,其性能的好坏直接影响系统测量的可靠性和准确性。超声波换能器按收发方式可分为分体式和一体式，按照结构又分为开放式和密封式。		

​		换能器的工作频率是测量系统的主要技术参数，它直接影响超声波的扩散和吸收损失，障碍物反射损失等。超声波换能器中心频率的选取主要考虑以下两点:

(1）如果测量距离较远，则超声波在传播的时候能量损失就会相对增加，由于介质对声波的吸收与声波频率的平方成正比，为减少声波在传播时的损失，就需要降低超声波换能器的中心频率;

(2〉由于换能器的中心频率越高，它的指向性就越好，分辨率也就越高，因而从被测物质表面的粗糙性和复杂性来看,中心频率越高则声波的波长越短,测量的分辨率就高,测量的准确性也就越高。

​		该系统在检测淤泥界面时，声波在水中传播，而且超声波探头需安置在水中，故需要选用防水型探头，在这里选用收发-一体的防水型探头，又因为淤泥表面比较复杂，对超声波能量吸收比较大，所以要选用颊率较高的探头，综合考虑之后最终选用200kHz的探头，型号为TCF200-47TR1。

## 3.2 单片机处理器

​		选择AT89C51单片机作为核心处理器，AT89C51是一种带4K字节闪烁可编程可擦除只读存储器（FPEROM—Falsh Programmable and Erasable Read Only  Memory）的低电压，高性能CMOS8位微处理器，俗称单片机。该器件采用ATMEL高密度非易失存储器制造技术制造，与工业标准的MCS-51指令集和输出管脚相兼容。由于将多功能8位CPU和闪烁存储器组合在单个芯片中，ATMEL的AT89C51是一种高效微控制器，为很多嵌入式控制系统提供了一种灵活性高且价廉的方案。

​		主要作用：

1. 控制超声波的发射与接收；
2. 处理接收的电路信号；
3. 进行数据的处理，将时间转换成距离。

## 3.3 温度补偿模块

​		传感器在水仓测量时的环境对其有一定影响，实验数据表明，在一定的温度范围内，每上升一摄氏度，超声波的传播速度就增加0.6m/s，因此，我们要考虑温度带来的误差。

​		声速与温度的关系为：
$$
C=331.45+0.607*t
$$
C为补偿后的速度，t为空气中的温度。

我们选用温度测量芯片DSl8B20获得空气中的温度，然后根据公式进行声速的补偿。DSl8B20是支持“一线总线”接口的温度传感器，它具有体积小、功耗少、性能好、 抗干扰能力强、容易与微处理器连接等优点，可将测量温度转化成串行数字信号供单片机处理，封装如图所示，它的温度测量范围为--55℃～+125℃，可编程为9位～12位 A／D转换精度，测温分辨率可达到0．0625 ℃。

![image-20210409153941626](C:\Users\LaoYao\AppData\Roaming\Typora\typora-user-images\image-20210409153941626.png)

​                                                                                   图1：DSl8B20封装图

![image-20210409154110123](C:\Users\LaoYao\AppData\Roaming\Typora\typora-user-images\image-20210409154110123.png)

​																					图2： DSl8B20外围电路

## 3.4 去噪模块

​		信号采集地点处于开采区域，会有大量震动噪声而且还有其他不稳定因素。震动对于泥位的测量来说最主要的影响为泥位不平稳，若是较大的波动则会影响到超声波传感器采集数据的精度。从而传给上位机的数据不是实时的泥位。

​		另外，由于采用了新的通信方式，其产生的误差也会叠加到信号中，严重影响了对实际信号的识别，若不消除噪声，可能会带来严重的失真效果。

​		人们根据噪声的特点开发了多种去噪方法，最常用的是：

1. 频率中低通滤波

   根据噪声对应频域中的高频分量, 而信号频谱分布于一个有限区间的特点，用傅里叶变换将信号变换，然后进行低通滤波，从而完成去噪。但是低通滤波会丢失一些细节信息，是信号边缘变得模糊。

2. 平滑滤波

   平滑滤波用低通滤波器完成, 将噪声对应的高频分量过滤, 使图像平滑, 从而达到去噪目的。包括领域平均法、中值滤波等。

   由于中值滤波不是简单的取平均值, 因此产生的模糊较少, 不仅能消除噪声, 而且能保护图像的边缘和细节信息。但是对于消除高斯白噪声效果比均值滤波的效果差，而且对于图像中点、线、尖顶等细节较多的图像不适合采用中值滤波法。

3. 小波去噪

   小波变换具有良好的时频局部化性质, 利用其多尺度多分辨率的特点, 在去除噪声的同时, 能很好的保留图像中的细节信息, 取得较好的去噪效果。

   小波去噪方法的成功主要得益于小波变换具有如下特点：(1) 低熵性; (2) 多分率, 可以非常好地刻画信号的非平稳特征, 如边缘、尖峰、断点等; (3) 去相关性,  小波变换可以对信号进行去相关分析, 且噪声在变换后有白化趋势, 所以小波域比时域更利于去噪; (4)  选基灵活性。小波去噪的主要方法有模极大值法、相关法、阈值法等, 其中阈值法因去噪简单, 容易实现的优点, 得到广泛应用。

​        使用小波去噪, 图像边缘信息会得到保留，在高频部分,同时利用其多尺度多分辨率的特点,  采用逐渐精细的取样步长， 突出图像中的更多的细节, 可以在去噪的过程中保留更多的图像细节, 去噪效果要优于传统的滤波方法。因此我们选择小波去噪方法作为我们系统的去噪法。

## 3.5 通讯部分

​		在解决了数据测量的部分后，如何将数据传入上位机是一个值得讨论的问题。矿井中水仓和上位机的距离动辄上千米，若是采用传统的传输方式，如有线传输，他的建立必须架设电缆，或挖掘电缆沟，因此需要大量的人力和物力，最后的成本是非常高的，使用这种方式进行传输出现问题时也不好排除，只能一点点的进行判断是否哪块的线出现问题。而且采样率低，通信协议复杂且安装不方便。而使用无线通信方式就不需要花费大量的时间和资源去设长距离的电缆或者挖掘漫长的电缆沟，这个工程周期可能就需要数个月的时间，而且它更灵活，无线信号可以从一个发射器发出到许多接收器而不需要电缆。所有无线信号都是随电磁波通过空气传输的，电磁波是由电子部分和能量部分组成的能量波。综上所述，我们选择无线传输方式进行数据的传输。

​	常用的无线通信方式有WIFI、蓝牙、LORA、NB-IOT、ZIGBEE、蜂窝信号等。

| 类型             | 频段             | 简介                                                         |
| ---------------- | ---------------- | ------------------------------------------------------------ |
| WIFI             | 2.4G 5G          | 局域网通信，功耗高，传输速度快，设备连接能力强               |
| 蓝牙             | 2.4G             | 设备间通信，低功耗蓝牙功耗很低，传输速度较慢，设备连接能力弱，一般主机最多连接7个从机 |
| ZIGBEE           | 2.4G             | 短距离通信，超低功耗，传输速率较低，只适合做简单的数据传输   |
| LORA             | 1G               | 长距离传输，功耗较低且可调节，需要自己部署网络               |
| NB-IOT           | 授权频段(1G以下) | 长距离传输，运营商运行，通信服务质量较好，费用较高           |
| 2G、4G等蜂窝通信 | 根据具体而定     | 长距离传输，可移动通信，费用较高                             |

​		经过认真的搜索资料进行比对后，我们发现LoRa是符合我们的需要的。LoRa是semtech公司创建的低功耗局域网无线标准，低功耗一般很难覆盖远距离，远距离一般功耗高，而LoRa最大的特点就是在同样的功耗条件下比其他无线方式传播的距离更远，实现了低功耗和远距离的统一，它在同样的功耗下比传统的无线射频通信距离扩大3-5倍。

LoRa的特性：

传输距离：城镇可达2-5 Km ， 郊区可达15 Km 。
工作频率：ISM 频段 包括433、868、915 MH等。
标准：IEEE 802.15.4g。
调制方式：基于扩频技术，线性调制扩频（CSS）的一个变种，具有前向纠错（FEC）能力，semtech公司私有专利技术。
容量：一个LoRa网关可以连接上千上万个LoRa节点。
电池寿命：长达10年。
安全：AES128加密。
传输速率：几百到几十Kbps，速率越低传输距离越长，这很像一个人挑东西，挑的多走不太远，少了可以走远。



## 3.6 软件部分

​		软件部分的功能主要分为显示实时数据、超过限定值后提醒管理员和提供下载泥位数据三大部分。因为我们需要实现的功能比较简洁，因此选择用web实现这些功能。

​		

## 3.7 数据库

​		对于一个系统来说，数据库的选择是非常重要的，而一个数据库的好坏是由多方面决定的。

1. 稳定可靠。

   数据库中存储的是企业中非常重要的数据，是核心部分，稳定可靠的数据库可以让系统稳定的运行，而不会因为宕机引发崩溃。如果选择了不稳定的数据库，那它可能会拖后腿，无论是计划的还是意外的事故都会让人恼火。

2. 可扩展

   数据库的数据是会随着时间的变化增加的，因此足够的存储量是必须的，但是我们不可能一次满足，这样成本就太高了，所以，一个具有良好的伸缩性及灵活的配置功能的产品就是我们需要的。

3. 安全性

   数据库的安全性是指数据库防止数据的泄露更改和破坏，因为数据库存储了大量重要数据，所以它的安全性非常重要。据库的安全控制主要通过用户标识与鉴别、存取控制、视图机制、审计、数据加密等机制完成。

常用数据库有Oracle、DB2、Microsoft SQL Server、Microsoft Access、MySQL、SQLite。

​		经过比较，我们选择Mysql数据库。Mysql是最流行的关系型数据库管理系统，在WEB应用方面MySQL是最好的RDBMS(Relational Database  Management System：关系数据库管理系统)应用软件之一。由瑞典MySQL  AB公司开发，目前属于Oracle公司。MySQL是一种关联数据库管理系统，关联数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。

1. Mysql是开源的，所以你不需要支付额外的费用。
2. Mysql支持大型的数据库。可以处理拥有上千万条记录的大型数据库。
3. MySQL使用标准的SQL数据语言形式。
4. Mysql可以允许于多个系统上，并且支持多种语言。这些编程语言包括C、C++、Python、Java、Perl、PHP、Eiffel、Ruby和Tcl等。
5. Mysql对PHP有很好的支持，PHP是目前最流行的Web开发语言。
6. MySQL支持大型数据库，支持5000万条记录的数据仓库，32位系统表文件最大可支持4GB，64位系统支持最大的表文件为8TB。
7. Mysql是可以定制的，采用了GPL协议，你可以修改源码来开发自己的Mysql系统。
8. MySQL默认不匹配大小写









# 参考文献

[1]李钊,李鸿.几种去噪方法的比较与改进[J].工业控制计算机,2012,25(08):9-10+49.